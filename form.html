<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>牙材券使用表單</title>
<style>
  body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
  form { background: white; max-width: 480px; margin: auto; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
  label { display: block; margin-top: 12px; font-weight: bold; }
  input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box;}
  button { margin-top: 20px; background: #0066cc; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;}
  .message { margin-top: 15px; font-weight: bold; }
</style>
</head>
<body>
  <form id="voucherForm">
    <label for="name">醫師姓名</label>
    <input id="name" name="醫師姓名" required />

    <label for="voucher">牙材卷號</label>
    <input id="voucher" name="牙材卷號" required />

    <label for="amount">使用金額</label>
    <input id="amount" name="使用金額" type="number" required min="0" />

    <label for="phone">手機</label>
    <input id="phone" name="手機" required />

    <label for="vendor">廠商</label>
    <select id="vendor" name="廠商" required>
      <option value="">請選擇廠商</option>
      <option value="01海昌">01海昌</option>
      <option value="02全星">02全星</option>
      <option value="03倍速">03倍速</option>
    </select>

    <label for="note">備註</label>
    <textarea id="note" name="備註" rows="3"></textarea>

    <button type="submit">送出</button>

    <div class="message" id="msg"></div>
  </form>

<script>
  const webAppURL = 'https://script.google.com/macros/s/AKfycbzZHfgKTbxVHqf7wk-LT3sjmHMgR-WfW8aGLaWz0tG0N0y8JPFtGr84U01-VXKRpWFfJQ/exec';

  document.getElementById('voucherForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const msgDiv = document.getElementById('msg');
    msgDiv.style.color = 'black';
    msgDiv.textContent = "送出中，請稍候...";

    const data = {
      醫師姓名: form['醫師姓名'].value.trim(),
      牙材卷號: form['牙材卷號'].value.trim(),
      使用金額: form['使用金額'].value.trim(),
      手機: form['手機'].value.trim(),
      廠商: form['廠商'].value,
      備註: form['備註'].value.trim()
    };

    try {
      const res = await fetch(webAppURL, {
        method: 'POST',
        mode: 'cors',
        credentials: 'omit',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (!res.ok) throw new Error(`HTTP錯誤，狀態碼：${res.status}`);

      const json = await res.json();

      if (json.status === 'success') {
        msgDiv.style.color = 'green';
        msgDiv.textContent = '✅ 表單送出成功！';
        form.reset();
      } else {
        msgDiv.style.color = 'red';
        msgDiv.textContent = '❌ 錯誤：' + json.message;
      }
    } catch (err) {
      msgDiv.style.color = 'red';
      msgDiv.textContent = '❌ 伺服器錯誤，請稍後再試：' + err.message;
    }
  });
</script>
</body>
</html>
